<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>キーボード設定ファイル</title>
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" href="../style.css" type="text/css">
</head>
<body>

<h1>キーボード設定ファイル</h1>

<p>
キーボード設定ファイルは、キーボードの各キーとそれに割りあてるられる機能(VT 端末の機能、ユーザー定義文字列の送出、Tera Term コマンドの実行、マクロの実行)を定義します。<br />
キーボード設定ファイルを編集することによって、自由にキー設定を変更することができます。
</p>

<p>
<A HREF="../commandline/teraterm.html">コマンドライン</A>で Tera Term が読み込むキーボード設定ファイルの名前を指定することができます。
ファイル名の拡張子を省略した場合は、".CNF"であるとみなされます。ファイル名を指定しない場合、ファイル <strong> KEYBOARD.CNF </strong> が読み込まれます。
</p>

<p>
配布パッケージには以下のキーボード設定ファイルが含まれています。
</p>

<dl>
  <dt>IBMKEYB.CNF</dt>
  <dd>IBM-PC/AT (いわゆる DOS/V マシン) 101 (106) キーボード用設定ファイルの例</dd>

  <dt>VT200.CNF</dt>
  <dd>VT220 端末でその位置に配置されているキーに相当するキー用のキーコードが送出されるようになっています。<br />
      たとえば End キーを押した場合、IBMKEYB.CNF の設定で Page Up キーを押したときと同じキーコードが送出されます。</dd>

  <dt>KEYBOARD.CNF</dt>
  <dd>インストール時には IBMKEYB.CNF と同一</dd>
</dl>

<p>
インストーラーは <strong>IBMKEYB.CNF</strong> を <strong>KEYBOARD.CNF</strong> としてコピーします。
もし違う設定を使いたい場合には、自分で適切なファイルをコピーして <strong>KEYBOARD.CNF</strong> を作成し直してください。
</p>

<p>
キーコードは KEYCODE.EXE で調べることができます。<A HREF="../reference/keycode.html">Keycode</A>を参照ください。
</p>

<h2>キーボードレイアウト</h2>

<h3>Editing keypad</h3>

<div style="float:left; text-align:center;">
  <table border="1">
    <tr>
      <td>Insert</td>
      <td>Home</td>
      <td>Page<br />Up</td>
    </tr>
    <tr>
      <td>Delete</td>
      <td>End</td>
      <td>Page<br />Down</td>
    </tr>
  </table>
  101 Keyboard
</div>
<div style="float:left; text-align:center; margin-left:1em;">
  <table border="1">
    <tr>
      <td>Find</td>
      <td>Insert<br />Here</td>
      <td>Re-<br />move</td>
    </tr>
    <tr>
      <td>Select</td>
      <td>Prev<br />Screen</td>
      <td>Next<br />Screen</td>
    </tr>
  </table>
  VT200 Keyboard
</div>
<br style="clear:both;">

<h3>Numeric keypad</h3>

<div style="float:left; text-align:center;">
  <table border="1">
    <tr>
      <td style="width:3em; height:3em;">Num<br />Lock</td>
      <td style="width:3em;">/</td>
      <td style="width:3em;">*</td>
      <td style="width:3em;">-</td>
    </tr>
    <tr>
      <td style=" height:3em;">7</td>
      <td>8</td>
      <td>9</td>
      <td rowspan="2">+</td>
    </tr>
    <tr>
      <td style=" height:3em;">4</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <td style=" height:3em;">1</td>
      <td>2</td>
      <td>3</td>
      <td rowspan="2">Enter</td>
    </tr>
    <tr>
      <td colspan="2"  style=" height:3em;">0</td>
      <td>.</td>
    </tr>
  </table>
  101 Keyboard
</div>
<div style="float:left; text-align:center; margin-left:1em;">
  <table border="1">
    <tr>
      <td style="width:3em; height:3em;">PF1</td>
      <td style="width:3em;">PF2</td>
      <td style="width:3em;">PF3</td>
      <td style="width:3em;">PF4</td>
    </tr>
    <tr>
      <td style=" height:3em;">7</td>
      <td>8</td>
      <td>9</td>
      <td>-</td>
    </tr>
    <tr>
      <td style=" height:3em;">4</td>
      <td>5</td>
      <td>6</td>
      <td>,</td>
    </tr>
    <tr>
      <td style=" height:3em;">1</td>
      <td>2</td>
      <td>3</td>
      <td rowspan="2">Enter</td>
    </tr>
    <tr>
      <td colspan="2" style=" height:3em;">0</td>
      <td>.</td>
    </tr>
  </table>
  VT200 Keyboard
</div>
<br style="clear:both;">



<h1>キーボード設定ファイル詳細</h1>

<h2 id="keyboard_cfg">キーボード設定ファイルの形式</h2>

<p>
キーボード設定ファイルの中で用いられる PC key code は PC の各キーまたはキーの
組み合わせに対応した数値で、使用するキーボードによって異なります。
</p>

<p>
キーボード設定ファイルには次の6つのセクションが存在します。
</p>

<ul>
<li>[VT editor keypad]
<li>[VT numeric keypad]
<li>[VT function keys]
<li>[X function keys]
<li>[Shortcut keys]
<li>[User keys]
</ul>

<h3>[VT editor keypad] セクション</h3>

<p>
VT 端末のエディターキーを PC キーに割り当てます。
</p>

<pre>
	形式:
		&lt;VT editor key name&gt;=&lt;PC key code&gt;

	&lt;VT editor key name&gt;
		Up, Down, Right, Left, Find, Insert, Remove, Select,
		Prev, Next

	&lt;PC key code&gt;
		PC key code (10進数)

	例:
		Up=328
</pre>

<h3>[VT numeric keypad] セクション</h3>

<p>
VT端末の数値キーを PC キーに割り当てます。
</p>

<pre>
	形式:
		&lt;VT numeric key name&gt;=&lt;PC key code&gt;

	&lt;VT numeric key name&gt;
		Num0, Num1, Num2, Num3, Num4, Num5, Num6, Num7, Num8,
		Num9, NumMinus, NumComma, NumPeriod, NumEnter, PF1,
		PF2, PF3, PF4

	&lt;PC key code&gt;
		PC key code (10進数)

	例:
		Num0=82
</pre>

<h4>注意</h4>

<p>
VT 端末ではメインキーパッドの "Enter" キーと数値キーパッドの
"Enter" キーが違う文字列を送出するモードがあるので、"NumEnter=" の
後にはメインキーの "Enter" の PC key code を書かないでください。
メインキーパッドの "Enter" と数値キーパッドの "Enter" が同じ
PC key code を発生するキーボード(例えば PC9801 キーボード)の場合は
注意が必要です。
</p>

<h3>[VT function keys] セクション</h3>

<p>
VT 端末のファンクションキーを PC キーに割り当てます。
</p>

<pre>
	形式:
		&lt;VT function key name&gt;=&lt;PC key code&gt;

	&lt;VT function key name&gt;
		(VT 端末のファンクションキー)
		Hold, Print, Break, F6, F7, F8, F9, F10, F11, F12,
		F13, F14, Help, Do, F17, F18, F19, F20
		(VT 端末の"ユーザー定義キー")
		UDK6, UDK7, UDK8, UDK9, UDK10, UDK11, UDK12, UDK13,
		UDK14, UDK15, UDK16, UDK17, UDK18, UDK19, UDK20

	&lt;PC key code&gt;
		PC key code (10進数)

	例:
		F6=64
</pre>

<h3>[X function keys] セクション</h3>

<p>
Xterm の F1-F5 キー、およびバックタブキーを PC キーに割り当てます。
</p>

<pre>
	形式:
		&lt;Xterm function key name&gt;=&lt;PC key code&gt;

	&lt;Xterm function key name&gt;
		XF1, XF2, XF3, XF4, XF5, XBackTab

	&lt;PC key code&gt;
		PC key code (10進数)

	例:
		XF1=59
</pre>

<h3>[Shortcut keys] セクション</h3>

<p>
Tera Term の機能をPC キーに割り当てます。
</p>

<pre>
	形式:
		&lt;Shortcut key name&gt;=&lt;PC key code&gt;

	&lt;Shortcut key name&gt;	機能
	---------------------------------------------------------
	EditCopy		[Edit] Copy コマンド
	EditPaste		[Edit] Paste コマンド
	EditPasteCR		[Edit] Paste&lt;CR&gt; コマンド
	EditCLS 		[Edit] Clear screen コマンド
	EditCLB 		[Edit] Clear buffer コマンド
	ControlOpenTEK		[Control] Open TEK コマンド
	ControlCloseTEK 	[Control] Close TEK コマンド
	LineUp			一行スクロールアップ
	LineDown		一行スクロールダウン
	PageUp			一ページスクロールアップ
	PageDown		一ページスクロールダウン
	BuffTop 		バッファー先頭へスクロール
	BuffBottom		バッファー最後へスクロール
	NextWin 		次の Tera Term ウィンドウへ移動
	PrevWin 		前の Tera Term ウィンドウへ移動
	NextShownWin 		次の最小化されていない Tera Term ウィンドウへ移動
	PrevShownWin 		前の最小化されていない Tera Term ウィンドウへ移動
	LocalEcho		Local echo を on/off する

	&lt;PC key code&gt;
		PC key code (10進数)

	例:
		LineUp=1352
</pre>

<h3>[User keys] セクション</h3>

<p>
ユーザーキーと、そのキーを押したときに実行される機能
(文字列の送出、マクロファイルの実行、メニューコマンドの実行)を
定義します。
</p>

<pre>
	形式:
		&lt;User key name&gt;=&lt;PC key code&gt;,&lt;Control flag&gt;,&lt;文字列&gt;
		&lt;User key name&gt;=off

	&lt;User key name&gt;
		User1, User2, User3,...., User99
		最大99個まで設定可能

	&lt;PC key code&gt;
		PC key code (10進数)

	&lt;Control flag&gt;
		キーを押したときに &lt;文字列&gt; をどのように取り扱うかを指定
		するフラグ。
			0	&lt;文字列&gt;をそのまま(8bit/文字として)送出する。
			1	&lt;文字列&gt;に含まれる文字や改行コードを
				Tera Term の設定にあわせて変換し、変換
				された文字列を送出する。
			2	&lt;文字列&gt;のファイル名のマクロファイルを
				実行する。
			3	メニュー ID &lt;文字列&gt; で指定される
				Tera Term のメニューコマンドを実行する。

	&lt;文字列&gt;:
		&lt;Control flag&gt; が 0 または 1 の場合、キーを押したときに
		送出される文字列。表示不可能な文字(制御文字等)はその
		文字コードを $ と2文字の16進数で表現する。
		(例: CR 文字は '$0D')。"$" そのものは "$24" で表現する。
		Tera Term 内部では設定ファイルはUTF-16(16bit/文字)で処理している。
		&lt;Control flag&gt; が 0 の場合、8bit/文字として処理する。
		U+0000..U+00FFは$00..$FFとしてそのまま送信する。
		それ以外は$FFとして送信する。
			U+0000..U+007F=基本ラテン文字
			U+0080..U+00FF=ラテン1補助
		&lt;Control flag&gt; が 1 の場合、
		Unicode文字列として処理する。

		&lt;Control flag&gt; が 2 の場合、
		実行されるマクロファイルのファイル名。

		&lt;Control flag&gt; が 3 の場合、
		実行されるメニューコマンドのメニュー ID (数字)。

	例:
		User1=1083,0,telnet myhost
		User2=1084,0,$0D$0A
		User3=1085,1,こんにちは。
		User4=1086,2,test.ttl
		User5=1087,3,50110
</pre>

<p>
メニュー IDについては「<a href="../reference/menu_id.html">メニュー ID 表</a>」参照。
</p>

<h2 id="note">注意</h2>

<p>
1つの PC key code はキーボード設定ファイルの中で一回だけ使用することが
できます。もし、1つの PC key code を複数のキー定義で使用した場合、
Tera Term がキーボード設定ファイルを読み込んだときに、
"Key code XXX is used more than once" という警告メッセージが表示されます。
この場合ある一つのキー定義だけが有効になり、その他は無視されます。
</p>

<p>
あるキー設定項目にどの PC キーも割り当てたくない場合は、以下のように
PC key code の代わりに "off" を指定してください。
</p>

<pre>
    EditCopy=off
</pre>

<h2>可能なキーの組み合わせ</h2>

<p>
キーボード設定ファイルで設定可能な PC のキーは, KEYCODE.EXE で PC key code が
表示されるキーです。単一のキーだけでなく、Ctrl, Shift, Alt を用いたキーの組み
合わせでも PC key code を表示させることができます。可能な組み合わせを
以下に示します。
</p>

<pre>
	Shift+key
	Ctrl+key
	Shift+Ctrl+key
	Shift+Alt+key
	Ctrl+Alt+key
	Shift+Ctrl+Alt+key
</pre>

<p>
Tera Term や Windows のショートカットキーに割り当てられているキーの組み合わせ
(例えば Alt+key など)はキーボード設定ファイルで指定できません。
</p>

<p>
ただし、Altキーをメタ・キーとして使う設定にしている場合(設定->キーボードにある
Metaキーにチェックをいれている状態)はAlt+keyも指定する事ができます。
キーコードは KEYCODE.EXE で調べられますが、単体のAltキーとの組合せには
対応していません。Altキーとの組合せでのキーコードを調べるには、単独での
キーコードを調べて、その値に2048を足してください。
</p>

<p>
たとえば、Alt+Vのキーコードは V が 47 なので、2095 となります。
</p>

<pre>
    ; Shift + Insert
    EditPaste=850
</pre>

<p>
これを例えば EditPaste=2095 に変更すれば、Metaキーをパススルーにしていても
Alt+Vで張り付けができるようになります。
</p>

<p>
Shift+Insertを残したままAlt+Vでの張り付けを行いたい場合は、KEYBOARD.CNF の
[User keys]セクションに以下の設定を追加します。
</p>

<pre>
    User1=2095,3,50230
</pre>

<h1>Q & A</h1>

<p>
<span class="qanda">Q.</span> Tera Term を起動するたびに "Key code XXX is used more than once" という
   メッセージがでる。<br>
<span class="qanda">A.</span> <a href="#note">注意</a>を参照。
</p>

<p>
<span class="qanda">Q.</span> PC の F1 キーを VT100 の PF1 キーとして使いたい。以下のように設定したが
   うまくいかない。<br>

<pre>
	[VT function keys]
	F1=PF1		(これはまちがい)
</pre>

<span class="qanda">A.</span> 左辺は <strong>PC</strong> のキーの名前ではなく <strong>VT端末</strong> の
   キーの名前を指定しなければなりません。また、右辺にはキーの名前ではなく、キーコードを指定して
   ください。
   また、キー設定を変えるときは、キーコードの重複使用をしないようにして
   ください(<a href="#note">注意</a>を参照)。<br>

   以下のように設定してください。<br>

<pre>
	[VT function keys]
	PF1=59			(59 は F1 キーのキーコード)
	[X function keys]
	;XF1=59			(キーコード 59 の重複使用をさける)
	XF1=off			("off" で置き換える)
</pre>
</p>

<p>
<span class="qanda">Q.</span> F1 キーを押したときにエスケープシーケンス ESC [ A を送出するように
   するための設定方法は?<br>
<span class="qanda">A.</span> ユーザーキーを使えば、好きな文字列を送出することができます。
   くわしくは、<a href="#keyboard_cfg">キーボード設定ファイルの形式</a>を読んでください。
   また、キー設定を変えるときは、キーコードの重複使用をしないようにして
   ください(<a href="#note">注意</a>を参照)。<br>

   以下のように設定してください。
<pre>
	[X function keys]
	;XF1=59			(F1 キーのキーコード 59 の重複使用をさける)
	XF1=off			("off" で置き換える)
	[User keys]
	User1=59,0,$1B[A		(ESC の ASCII コードは $1B)
</pre>
</p>

</body>
</html>
